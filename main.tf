module "dashboard_firestore" {
  source                               = "./modules/dashboard_firestore"
  project_id                           = var.project_id
  toggle_4583_5673_myusps_migration    = var.toggle_4583_5673_myusps_migration
  toggle_4583_5681_consumer_portal     = var.toggle_4583_5681_consumer_portal
  pitr_enablement                      = var.pitr_enablement
  dashboard_firestore_backup_retention = var.dashboard_firestore_backup_retention

}

module "mail_campaign_firestore" {
  source                                   = "./modules/mail_campaign_firestore"
  project_id                               = var.project_id
  pitr_enablement                          = var.pitr_enablement
  mail_campaign_firestore_backup_retention = var.mail_campaign_firestore_backup_retention
}

module "subscriber_firestore" {
  source                                 = "./modules/subscriber_firestore"
  project_id                             = var.project_id
  toggle_4583_1111_subscriber_services   = var.toggle_4583_1111_subscriber_services
  toggle_4583_5680_frontend              = var.toggle_4583_5680_frontend
  pitr_enablement                        = var.pitr_enablement
  subscribers_firestore_backup_retention = var.subscribers_firestore_backup_retention
  toggle_4583_5708_mdn_to_eng            = var.toggle_4583_5708_mdn_to_eng
}

module "cloud_storage" {
  source                                = "./modules/cloud_storage"
  project_id                            = var.project_id
  name_suffix                           = var.name_suffix
  toggle_4583_1111_subscriber_services  = var.toggle_4583_1111_subscriber_services
  toggle_4583_5681_consumer_portal      = var.toggle_4583_5681_consumer_portal
  toggle_4583_5708_mdn_to_eng           = var.toggle_4583_5708_mdn_to_eng
  toggle_4583_5717_rmin_backup_invar    = var.toggle_4583_5717_rmin_backup
  toggle_4583_xxxx_ext_caches           = var.toggle_4583_xxxx_ext_caches
  mics_extract_file_upload_topic_name   = module.pub_sub.rmin_mics_extract_file_upload_topic_name
  
  rmin_redis_export_backup_bucket_e_location_invar                     = var.rmin_redis_export_backup_bucket_e_location
  rmin_redis_export_backup_bucket_e_storage_class_invar                = var.rmin_redis_export_backup_bucket_e_storage_class
  rmin_redis_export_backup_bucket_e_lifecycle_rule_condition_age_invar = var.rmin_redis_export_backup_bucket_e_lifecycle_rule_condition_age
  
  rmin_bigquery_export_backup_bucket_e_location_invar                     = var.rmin_bigquery_export_backup_bucket_e_location
  rmin_bigquery_export_backup_bucket_e_storage_class_invar                = var.rmin_bigquery_export_backup_bucket_e_storage_class
  rmin_bigquery_export_backup_bucket_e_lifecycle_rule_condition_age_invar = var.rmin_bigquery_export_backup_bucket_e_lifecycle_rule_condition_age

}

module "cloud_tasks" {
  source                               = "./modules/cloud_tasks"
  toggle_4583_1111_subscriber_services = var.toggle_4583_1111_subscriber_services
  rmin_mics_extract_queue_id           = var.rmin_mics_extract_queue_id
  rmin_mics_extract_location_id        = var.rmin_mics_extract_location_id
}

module "cloud_run" {
  source                               = "./modules/cloud_run"
  environment                          = var.environment
  spring_profile                       = var.spring_profile
  project_id                           = var.project_id
  dataset                              = module.big_query.bigquery_dataset_id
  vpc_connector                        = module.connectors.vpc_connector_uri
  subscriber_vpc_connector             = module.connectors.subscriber_connector_uri
  api_vpc_connector                    = module.connectors.api_connector_uri
  toggle_4583_1111_subscriber_services = var.toggle_4583_1111_subscriber_services
  toggle_4583_5673_myusps_migration    = var.toggle_4583_5673_myusps_migration
  toggle_4583_5668_price_change        = var.toggle_4583_5668_price_change
  toggle_4583_5681_consumer_portal     = var.toggle_4583_5681_consumer_portal
  toggle_4583_5710_apigee_hybrid       = var.toggle_4583_5710_apigee_hybrid
  mail_campaign_image_bucket           = module.cloud_storage.rmin_mail_campaign_image_bucket_name
  package_campaign_image_bucket        = module.cloud_storage.rmin_package_campaign_image_bucket_name
  mail_campaign_image_bucket_ext       = module.cloud_storage.rmin_mail_campaign_image_bucket_name_ext
  package_campaign_image_bucket_ext    = module.cloud_storage.rmin_package_campaign_image_bucket_name_ext
  dashboard_api_logs_topic_name        = module.pub_sub.rmin_dashboard_api_logs_c_name
  toggle_4583_xxxx_mc_reporting        = var.toggle_4583_xxxx_mc_reporting
  toggle_4583_5666_redesign_phase2     = var.toggle_4583_5666_redesign_phase2
  toggle_4583_5680_frontend            = var.toggle_4583_5680_frontend

  dashboard_event_image_location                   = var.dashboard_event_image_location
  dashboard_event_version                          = var.dashboard_event_version
  dashboard_event_service_account                  = var.dashboard_event_service_account
  dashboard_event_min_instance_count               = var.dashboard_event_min_instance_count
  dashboard_event_max_instance_count               = var.dashboard_event_max_instance_count
  dashboard_event_execution_environment            = var.dashboard_event_execution_environment
  dashboard_event_max_instance_request_concurrency = var.dashboard_event_max_instance_request_concurrency
  dashboard_event_timeout                          = var.dashboard_event_timeout
  dashboard_event_cpu_value                        = var.dashboard_event_cpu_value
  dashboard_event_memory_value                     = var.dashboard_event_memory_value
  firestore_expiry_days                            = var.firestore_expiry_days
  dashboard_db_name                                = module.dashboard_firestore.dashboard_db_name
  dashboard_event_trace_ratio                      = var.dashboard_event_trace_ratio
  dashboard_event_trace_sample                     = var.dashboard_event_trace_sample
  dashboard_toggle_parcel_locker                   = var.dashboard_toggle_parcel_locker
  dashboard_zip5_done_topic                        = module.pub_sub.rmin_zip5_done_topic_c_name
  dashboard_toggle_send_to_locker_and_inbound      = var.dashboard_toggle_send_to_locker_and_inbound
  dashboard_toggle_usps_possession_ind             = var.dashboard_toggle_usps_possession_ind

  dashboard_api_image_location                   = var.dashboard_api_image_location
  dashboard_api_version                          = var.dashboard_api_version
  dashboard_api_internal_version                 = var.dashboard_api_internal_version
  dashboard_api_service_account                  = var.dashboard_api_service_account
  dashboard_api_min_instance_count               = var.dashboard_api_min_instance_count
  dashboard_api_max_instance_count               = var.dashboard_api_max_instance_count
  dashboard_api_execution_environment            = var.dashboard_api_execution_environment
  dashboard_api_max_instance_request_concurrency = var.dashboard_api_max_instance_request_concurrency
  dashboard_api_timeout                          = var.dashboard_api_timeout
  dashboard_api_cpu_value                        = var.dashboard_api_cpu_value
  dashboard_api_memory_value                     = var.dashboard_api_memory_value
  mailCampaignCache_ip                           = module.memstore.rmin_mail_campaign_cache_c_ip
  mailCampaignCache_read_ip                      = module.memstore.rmin_mail_campaign_cache_c_read_ip
  packageCampaignCache_ip                        = module.memstore.rmin_package_campaign_cache_c_ip
  packageCampaignCache_read_ip                   = module.memstore.rmin_package_campaign_cache_c_read_ip
  mailCampaignCache_ext_ip                       = module.memstore.rmin_mail_campaign_cache_ext_c_ip
  mailCampaignCache_read_ext_ip                  = module.memstore.rmin_mail_campaign_cache_ext_c_read_ip
  packageCampaignCache_ext_ip                    = module.memstore.rmin_package_campaign_cache_ext_c_ip
  packageCampaignCache_read_ext_ip               = module.memstore.rmin_package_campaign_cache_ext_c_read_ip
  dashboard_api_toggle_mail_tracking_cloud_url   = var.dashboard_api_toggle_mail_tracking_cloud_url
  dashboard_api_toggle_fraud_logic_external      = var.dashboard_api_toggle_fraud_logic_external
  dashboard_api_toggle_parcel_logic_external     = var.dashboard_api_toggle_parcel_logic_external
  dashboard_api_toggle_fraud_logic_internal      = var.dashboard_api_toggle_fraud_logic_internal
  dashboard_api_toggle_parcel_logic_internal     = var.dashboard_api_toggle_parcel_logic_internal

  dashboard_api_internal_min_instance_count               = var.dashboard_api_internal_min_instance_count
  dashboard_api_internal_max_instance_request_concurrency = var.dashboard_api_internal_max_instance_request_concurrency
  dashboard_api_internal_max_instance_count               = var.dashboard_api_internal_max_instance_count
  dashboard_api_internal_timeout                          = var.dashboard_api_internal_timeout
  dashboard_api_internal_cpu_value                        = var.dashboard_api_internal_cpu_value
  dashboard_api_internal_memory_value                     = var.dashboard_api_internal_memory_value
  dashboard_api_toggle_ecrypt_prem_digest_campaign_clicks = var.dashboard_api_toggle_ecrypt_prem_digest_campaign_clicks

  eagan_proxy_image_location                   = var.eagan_proxy_image_location
  eagan_proxy_version                          = var.eagan_proxy_version
  eagan_proxy_service_account                  = var.eagan_proxy_service_account
  eagan_proxy_min_instance_count               = var.eagan_proxy_min_instance_count
  eagan_proxy_max_instance_count               = var.eagan_proxy_max_instance_count
  eagan_proxy_execution_environment            = var.eagan_proxy_execution_environment
  eagan_proxy_max_instance_request_concurrency = var.eagan_proxy_max_instance_request_concurrency
  eagan_proxy_timeout                          = var.eagan_proxy_timeout
  eagan_proxy_cpu_value                        = var.eagan_proxy_cpu_value
  eagan_proxy_memory_value                     = var.eagan_proxy_memory_value
  eagan_proxy_logs_topic_name                  = module.pub_sub.rmin_eagan_proxy_logs_topic_name

  image_api_image_location                   = var.image_api_image_location
  image_api_version                          = var.image_api_version
  image_api_service_account                  = var.image_api_service_account
  dashboard_api_decryptionKey                = var.dashboard_api_decryptionKey
  image_api_min_instance_count               = var.image_api_min_instance_count
  image_api_max_instance_count               = var.image_api_max_instance_count
  image_api_execution_environment            = var.image_api_execution_environment
  image_api_max_instance_request_concurrency = var.image_api_max_instance_request_concurrency
  image_api_timeout                          = var.image_api_timeout
  image_api_cpu_value                        = var.image_api_cpu_value
  image_api_memory_value                     = var.image_api_memory_value
  image_api_logs_topic_name                  = module.pub_sub.rmin_image_api_logs_c_name
  image_api_external_url                     = var.image_api_external_url
  subscriber_dropbox_bucket                  = module.cloud_storage.rmin_subscriber_dropbox_bucket_name

  login_api_image_location                   = var.login_api_image_location
  login_api_version                          = var.login_api_version
  login_api_service_account                  = var.login_api_service_account
  login_api_min_instance_count               = var.login_api_min_instance_count
  login_api_max_instance_count               = var.login_api_max_instance_count
  login_api_execution_environment            = var.login_api_execution_environment
  login_api_max_instance_request_concurrency = var.login_api_max_instance_request_concurrency
  login_api_timeout                          = var.login_api_timeout
  login_api_cpu_value                        = var.login_api_cpu_value
  login_api_memory_value                     = var.login_api_memory_value
  login_api_logs_topic                       = module.pub_sub.rmin_login_api_logs_topic_name
  subscriber_event_topic                     = module.pub_sub.rmin_subscriber_event_topic_name

  firestore_subscriber_expiry_days                = var.firestore_subscriber_expiry_days
  subscriber_api_cpu_value                        = var.subscriber_api_cpu_value
  subscriber_api_execution_environment            = var.subscriber_api_execution_environment
  subscriber_api_image_location                   = var.subscriber_api_image_location
  subscriber_api_max_instance_count               = var.subscriber_api_max_instance_count
  subscriber_api_max_instance_request_concurrency = var.subscriber_api_max_instance_request_concurrency
  subscriber_api_memory_value                     = var.subscriber_api_memory_value
  subscriber_api_min_instance_count               = var.subscriber_api_min_instance_count
  subscriber_api_service_account                  = var.subscriber_api_service_account
  subscriber_api_timeout                          = var.subscriber_api_timeout
  subscriber_api_version                          = var.subscriber_api_version
  subscriber_api_log_topic                        = module.pub_sub.rmin_subscriber_api_logs_topic_name
  subscriber_opt_in_settings_topic                = module.pub_sub.rmin_subscriber_opt_in_settings_topic_name
  digest_opt_out_reason_topic                     = module.pub_sub.rmin_digest_opt_out_reason_topic_name
  zip5_initiative_cache_ip                        = var.rmin_zip5_initiatives_cache_c_replica_enabled ? module.memstore.rmin_zip5_initiatives_sync_cache_c_read_ip : module.memstore.rmin_zip5_initiatives_sync_cache_c_ip

  subscriber_event_cpu_value                        = var.subscriber_event_cpu_value
  subscriber_event_execution_environment            = var.subscriber_event_execution_environment
  subscriber_event_image_location                   = var.subscriber_event_image_location
  subscriber_event_max_instance_count               = var.subscriber_event_max_instance_count
  subscriber_event_max_instance_request_concurrency = var.subscriber_event_max_instance_request_concurrency
  subscriber_event_memory_value                     = var.subscriber_event_memory_value
  subscriber_event_min_instance_count               = var.subscriber_event_min_instance_count
  subscriber_event_service_account                  = var.subscriber_event_service_account
  subscriber_event_timeout                          = var.subscriber_event_timeout
  subscriber_event_version                          = var.subscriber_event_version
  subscribers_db_name                               = module.subscriber_firestore.subscribers_db_name

  mics_subscriber_max_instance_count               = var.mics_subscriber_max_instance_count
  mics_subscriber_min_instance_count               = var.mics_subscriber_min_instance_count
  mics_subscriber_service_account                  = var.mics_subscriber_service_account
  mics_subscriber_execution_environment            = var.mics_subscriber_execution_environment
  mics_subscriber_max_instance_request_concurrency = var.mics_subscriber_max_instance_request_concurrency
  mics_subscriber_timeout                          = var.mics_subscriber_timeout
  mics_subscriber_version                          = var.mics_subscriber_version
  mics_subscriber_image_location                   = var.mics_subscriber_image_location
  mics_subscriber_cpu_value                        = var.mics_subscriber_cpu_value
  mics_subscriber_memory_value                     = var.mics_subscriber_memory_value
  mics_subscriber_bucket                           = module.cloud_storage.rmin_mics_extract_bucket_name
  subscriber_cache_ip                              = var.rmin_fs_subscriber_cache_replica_enabled ? module.memstore.rmin_firestore_subscriber_cache_c_read_ip : module.memstore.rmin_firestore_subscriber_cache_c_ip
  mics_subscriber_table                            = module.big_query.mics_extract_table_name

  package_api_cpu_value                        = var.package_api_cpu_value
  package_api_execution_environment            = var.package_api_execution_environment
  package_api_image_location                   = var.package_api_image_location
  package_api_logs_topic                       = module.pub_sub.rmin_package_api_logs_topic_name
  package_api_max_instance_count               = var.package_api_max_instance_count
  package_api_max_instance_request_concurrency = var.package_api_max_instance_request_concurrency
  package_api_memory_value                     = var.package_api_memory_value
  package_api_min_instance_count               = var.package_api_min_instance_count
  package_api_service_account                  = var.package_api_service_account
  package_api_timeout                          = var.package_api_timeout
  package_api_version                          = var.package_api_version
  package_api_usps_base_url                    = var.package_api_usps_base_url

  package_event_cpu_value                        = var.package_event_cpu_value
  package_event_execution_environment            = var.package_event_execution_environment
  package_event_image_location                   = var.package_event_image_location
  package_event_max_instance_count               = var.package_event_max_instance_count
  package_event_max_instance_request_concurrency = var.package_event_max_instance_request_concurrency
  package_event_memory_value                     = var.package_event_memory_value
  package_event_min_instance_count               = var.package_event_min_instance_count
  package_event_service_account                  = var.package_event_service_account
  package_event_timeout                          = var.package_event_timeout
  package_event_version                          = var.package_event_version

  package_notification_cpu_value                        = var.package_notification_cpu_value
  package_notification_execution_environment            = var.package_notification_execution_environment
  package_notification_image_location                   = var.package_notification_image_location
  package_notification_logs_topic                       = module.pub_sub.rmin_package_notification_logs_topic_name
  package_notification_max_instance_count               = var.package_notification_max_instance_count
  package_notification_max_instance_request_concurrency = var.package_notification_max_instance_request_concurrency
  package_notification_memory_value                     = var.package_notification_memory_value
  package_notification_min_instance_count               = var.package_notification_min_instance_count
  package_notification_service_account                  = var.package_notification_service_account
  package_notification_timeout                          = var.package_notification_timeout
  package_notification_version                          = var.package_notification_version

  package_notification_sms_cpu_value                        = var.package_notification_sms_cpu_value
  package_notification_sms_execution_environment            = var.package_notification_sms_execution_environment
  package_notification_sms_max_instance_count               = var.package_notification_sms_max_instance_count
  package_notification_sms_max_instance_request_concurrency = var.package_notification_sms_max_instance_request_concurrency
  package_notification_sms_memory_value                     = var.package_notification_sms_memory_value
  package_notification_sms_min_instance_count               = var.package_notification_sms_min_instance_count
  package_notification_sms_timeout                          = var.package_notification_sms_timeout

  package_notification_update_cpu_value                        = var.package_notification_update_cpu_value
  package_notification_update_execution_environment            = var.package_notification_update_execution_environment
  package_notification_update_image_location                   = var.package_notification_update_image_location
  package_notification_update_max_instance_count               = var.package_notification_update_max_instance_count
  package_notification_update_max_instance_request_concurrency = var.package_notification_update_max_instance_request_concurrency
  package_notification_update_memory_value                     = var.package_notification_update_memory_value
  package_notification_update_min_instance_count               = var.package_notification_update_min_instance_count
  package_notification_update_service_account                  = var.package_notification_update_service_account
  package_notification_update_timeout                          = var.package_notification_update_timeout
  package_notification_update_version                          = var.package_notification_update_version
  package_notification_topic                                   = module.pub_sub.rmin_package_notification_topic_name
  package_sms_notification_topic                               = module.pub_sub.rmin_package_sms_notification_topic_name

  mc_report_image_location                           = var.mc_report_image_location
  mc_report_version                                  = var.mc_report_version
  mc_report_service_account                          = var.mc_report_service_account
  mc_report_min_instance_count                       = var.mc_report_min_instance_count
  mc_report_max_instance_count                       = var.mc_report_max_instance_count
  mc_report_execution_environment                    = var.mc_report_execution_environment
  mc_report_max_instance_request_concurrency         = var.mc_report_max_instance_request_concurrency
  mc_report_timeout                                  = var.mc_report_timeout
  mc_report_cpu_value                                = var.mc_report_cpu_value
  mc_report_memory_value                             = var.mc_report_memory_value
  mc_cloud_mail_campaign_reporting_job_logs_bq_table = module.big_query.mc_cloud_mail_campaign_reporting_job_logs_bq_table_id
  mc_mail_campaign_firestore_db                      = module.mail_campaign_firestore.mail_campaign_db_name
  mc_po_campaign_reporting_topic_name                = module.pub_sub.rmin_po_campaign_reporting_topic_c_name

  mc_api_image_location                   = var.mc_api_image_location
  mc_api_version                          = var.mc_api_version
  mc_api_service_account                  = var.mc_api_service_account
  mc_api_min_instance_count               = var.mc_api_min_instance_count
  mc_api_max_instance_count               = var.mc_api_max_instance_count
  mc_api_execution_environment            = var.mc_api_execution_environment
  mc_api_max_instance_request_concurrency = var.mc_api_max_instance_request_concurrency
  mc_api_timeout                          = var.mc_api_timeout
  mc_api_cpu_value                        = var.mc_api_cpu_value
  mc_api_memory_value                     = var.mc_api_memory_value
  mc_api_toggle_summary_by_detail         = var.mc_api_toggle_summary_by_detail

  package_vpc_connector     = module.connectors.package_connector_uri
  rmin_peripheral_connector = module.connectors.rmin_peripheral_conn_id

  qr_code_image_location                   = var.qr_code_image_location
  qr_code_version                          = var.qr_code_version
  qr_code_service_account                  = var.qr_code_service_account
  qr_code_min_instance_count               = var.qr_code_min_instance_count
  qr_code_max_instance_count               = var.qr_code_max_instance_count
  qr_code_execution_environment            = var.qr_code_execution_environment
  qr_code_max_instance_request_concurrency = var.qr_code_max_instance_request_concurrency
  qr_code_timeout                          = var.qr_code_timeout
  qr_code_cpu_value                        = var.qr_code_cpu_value
  qr_code_memory_value                     = var.qr_code_memory_value
  qr_code_service_job_logs_bq_table        = module.big_query.qr_code_service_job_logs_bq_table_id
  qr_code_rest_endpoint                    = var.qr_code_rest_endpoint
  dashboard_event_topic_name               = module.pub_sub.rmin_dashboard_event_topic_e_name
  qr_code_image_bucket_name                = module.cloud_storage.rmin_qr_code_bucket_c_name
  qr_code_toggle_retry                     = var.qr_code_toggle_retry
  qr_code_toggle_usps_possession_ind       = var.qr_code_toggle_usps_possession_ind

  digest_tracking_image_location                   = var.digest_tracking_image_location
  digest_tracking_version                          = var.digest_tracking_version
  digest_tracking_service_account                  = var.digest_tracking_service_account
  digest_tracking_min_instance_count               = var.digest_tracking_min_instance_count
  digest_tracking_max_instance_count               = var.digest_tracking_max_instance_count
  digest_tracking_execution_environment            = var.digest_tracking_execution_environment
  digest_tracking_max_instance_request_concurrency = var.digest_tracking_max_instance_request_concurrency
  digest_tracking_timeout                          = var.digest_tracking_timeout
  digest_tracking_cpu_value                        = var.digest_tracking_cpu_value
  digest_tracking_memory_value                     = var.digest_tracking_memory_value
  digest_tracking_event_topic                      = module.pub_sub.rmin_digest_event_topic_c_name
  digest_tracking_click_topic                      = module.pub_sub.rmin_digest_click_event_topic_name
  digest_tracking_error_topic                      = module.pub_sub.rmin_digest_tracking_errors_topic_name
  digest_tracking_redirect_https_env_url           = var.digest_tracking_redirect_https_env_url
  digest_tracking_cloud_url_encrypted_toggle       = var.digest_tracking_cloud_url_encrypted_toggle
  digest_tracking_mc_click_data_sync_topic         = module.pub_sub.rmin_mc_click_data_sync_topic_name
  digest_tracking_mc_click_topic                   = module.pub_sub.rmin_mc_click_logs_topic_name
  digest_tracking_base_url_ridealong_click         = var.digest_tracking_base_url_ridealong_click
  digest_tracking_base_url_click_track             = var.digest_tracking_base_url_click_track

  consumer_portal_max_instance_count               = var.consumer_portal_max_instance_count
  consumer_portal_min_instance_count               = var.consumer_portal_min_instance_count
  consumer_portal_service_account                  = var.consumer_portal_service_account
  consumer_portal_execution_environment            = var.consumer_portal_execution_environment
  consumer_portal_max_instance_request_concurrency = var.consumer_portal_max_instance_request_concurrency
  consumer_portal_timeout                          = var.consumer_portal_timeout
  consumer_portal_version                          = var.consumer_portal_version
  consumer_portal_image_location                   = var.consumer_portal_image_location
  consumer_portal_cpu_value                        = var.consumer_portal_cpu_value
  consumer_portal_memory_value                     = var.consumer_portal_memory_value
  rmin_global_elements_bucket_c_name               = module.cloud_storage.rmin_global_elements_bucket_c_name

  dashboard_event_cpu_idle        = var.dashboard_event_cpu_idle
  subscriber_api_cpu_idle         = var.subscriber_api_cpu_idle
  subscriber_event_cpu_idle       = var.subscriber_event_cpu_idle
  dashboard_api_cpu_idle          = var.dashboard_api_cpu_idle
  dashboard_api_internal_cpu_idle = var.dashboard_api_internal_cpu_idle
  eagan_proxy_cpu_idle            = var.eagan_proxy_cpu_idle
  image_api_cpu_idle              = var.image_api_cpu_idle
  login_api_cpu_idle              = var.login_api_cpu_idle
  mics_subscriber_cpu_idle        = var.mics_subscriber_cpu_idle
  package_api_cpu_idle            = var.package_api_cpu_idle
  package_event_cpu_idle          = var.package_event_cpu_idle
  package_notification_cpu_idle   = var.package_notification_cpu_idle
  mc_report_cpu_idle              = var.mc_report_cpu_idle
  mc_api_cpu_idle                 = var.mc_api_cpu_idle
  qr_code_cpu_idle                = var.qr_code_cpu_idle
  digest_tracking_cpu_idle        = var.digest_tracking_cpu_idle
  consumer_portal_cpu_idle        = var.consumer_portal_cpu_idle
}

module "pub_sub" {
  source                                            = "./modules/pub_sub"
  project_id                                        = var.project_id
  name_suffix                                       = var.name_suffix
  toggle_4583_1111_subscriber_services              = var.toggle_4583_1111_subscriber_services
  toggle_4583_5673_myusps_migration                 = var.toggle_4583_5673_myusps_migration
  toggle_4583_5668_price_change                     = var.toggle_4583_5668_price_change
  toggle_4583_5681_consumer_portal                  = var.toggle_4583_5681_consumer_portal
  toggle_4583_5690_ptr2                             = var.toggle_4583_5690_ptr2
  toggle_4583_5680_frontend                         = var.toggle_4583_5680_frontend
  toggle_4583_5710_apigee_hybrid                    = var.toggle_4583_5710_apigee_hybrid
  toggle_4583_xxxx_ext_caches                       = var.toggle_4583_xxxx_ext_caches
  dashboard_event_sub_service_account_email         = var.dashboard_event_sub_service_account_email
  email_topic_sub_service_account_email             = var.email_topic_sub_service_account_email
  dashboard_event_sub_push_endpoint                 = module.cloud_run.dashboard_cloud_run_url
  email_relay_cutover_url                           = var.email_relay_cutover_url
  image_api_logs_table_id                           = module.big_query.image_api_logs_table_id
  mc_report_sub_service_account_email               = var.mc_report_sub_service_account_email
  mc_report_cloud_sub_push_endpoint                 = var.mc_report_cloud_sub_push_endpoint
  account_revision_table_id                         = module.big_query.account_revision_table_id
  dashboard_api_logs_table_id                       = module.big_query.dashboard_api_logs_table_id
  dashboard_subscription_ack_deadline_seconds       = var.dashboard_subscription_ack_deadline_seconds
  dashboard_subscription_enable_message_ordering    = var.dashboard_subscription_enable_message_ordering
  dashboard_subscription_max_backoff                = var.dashboard_subscription_max_backoff
  dashboard_subscription_message_retention_duration = var.dashboard_subscription_message_retention_duration
  dashboard_subscription_min_backoff                = var.dashboard_subscription_min_backoff
  dashboard_subscription_retain_acked_messages      = var.dashboard_subscription_retain_acked_messages
  dashboard_subscription_ttl                        = var.dashboard_subscription_ttl
  physical_address_revision_table_id                = module.big_query.physical_address_revision_table_id
  subscriber_api_logs_table_id                      = module.big_query.subscriber_api_logs_table_id
  eagan_proxy_logs_table_id                         = module.big_query.eagan_proxy_logs_table_id
  subscriber_event_push_endpoint                    = module.cloud_run.subscriber_event_cloud_run_url
  subscriber_event_service_account_email            = var.subscriber_event_service_account_email
  qr_code_service_sub_service_account_email         = var.qr_code_service_sub_service_account_email
  qr_code_service_sub_push_endpoint                 = var.qr_code_service_sub_push_endpoint
  package_api_logs_table_id                         = module.big_query.package_api_logs_table_id
  package_event_push_endpoint                       = module.cloud_run.package_event_cloud_run_url
  package_notification_logs_table_id                = module.big_query.package_notification_logs_table_id
  package_notification_push_endpoint                = module.cloud_run.package_notification_cloud_run_url
  package_notification_update_push_endpoint         = module.cloud_run.package_notification_update_cloud_run_url
  rmin_package_event_sa_email                       = var.package_event_service_account
  rmin_package_notification_sa_email                = var.package_notification_service_account
  rmin_package_notification_update_sa_email         = var.package_notification_update_service_account
  toggle_4583_5666_redesign_phase2                  = var.toggle_4583_5666_redesign_phase2
  digest_click_logs_table_id                        = module.big_query.digest_click_logs_table_id
  digest_tracking_errors_table_id                   = module.big_query.digest_tracking_errors_table_id
  mc_click_logs_table_id                            = module.big_query.mc_click_logs_table_id
  digest_open_logs_table_id                         = module.big_query.digest_open_logs_bq_table_id
  digest_opt_out_reason_table_id                    = module.big_query.digest_opt_out_reason_bq_table_id
  subscriber_opt_in_settings_dlt_table_id           = module.big_query.subscriber_opt_in_settings_dlt_bq_table_id
  toggle_4583_xxxx_mc_reporting                     = var.toggle_4583_xxxx_mc_reporting
  login_api_logs_table_id                           = module.big_query.login_api_logs_table_id
  package_sms_notification_push_endpoint            = module.cloud_run.package_sms_notification_cloud_run_url
}

module "big_query" {
  source                               = "./modules/big_query"
  project_id                           = var.project_id
  toggle_4583_1111_subscriber_services = var.toggle_4583_1111_subscriber_services
  toggle_4583_5673_myusps_migration    = var.toggle_4583_5673_myusps_migration
  toggle_4583_5681_consumer_portal     = var.toggle_4583_5681_consumer_portal
  name_suffix                          = var.name_suffix
  partition_expiration_ms              = var.partition_expiration_ms
  zip5_timezone_bucket                 = module.cloud_storage.rmin_template_bucket_e_name
  toggle_4583_xxxx_mc_reporting        = var.toggle_4583_xxxx_mc_reporting
  toggle_4583_5666_redesign_phase2     = var.toggle_4583_5666_redesign_phase2
  toggle_4583_5680_frontend            = var.toggle_4583_5680_frontend
  toggle_4583_5708_mdn_to_eng          = var.toggle_4583_5708_mdn_to_eng
  toggle_4583_xxxx_ext_caches          = var.toggle_4583_xxxx_ext_caches
}

module "cloud_function" {
  source                                                      = "./modules/cloud_function"
  toggle_4583_1111_subscriber_services                        = var.toggle_4583_1111_subscriber_services
  toggle_4583_5673_myusps_migration                           = var.toggle_4583_5673_myusps_migration
  toggle_4583_5681_consumer_portal                            = var.toggle_4583_5681_consumer_portal
  toggle_4583_5690_ptr2                                       = var.toggle_4583_5690_ptr2
  toggle_4583_5680_frontend                                   = var.toggle_4583_5680_frontend
  toggle_4583_5710_apigee_hybrid                              = var.toggle_4583_5710_apigee_hybrid
  toggle_4583_5708_mdn_to_eng                                 = var.toggle_4583_5708_mdn_to_eng
  toggle_4583_xxxx_ext_caches                                 = var.toggle_4583_xxxx_ext_caches
  image_dimension_service_account                             = var.image_dimension_service_account
  image_dimension_function_name                               = var.image_dimension_function_name
  image_dimension_zip_file_name                               = var.image_dimension_zip_file_name
  dashboard_db_name                                           = module.dashboard_firestore.dashboard_db_name
  dashboard_db_location                                       = module.dashboard_firestore.dashboard_db_location_id
  image_dimension_min_instance                                = var.image_dimension_min_instance
  image_dimension_max_instance                                = var.image_dimension_max_instance
  image_dimension_memory                                      = var.image_dimension_memory
  image_dimension_timeout                                     = var.image_dimension_timeout
  image_dimension_max_concurrency                             = var.image_dimension_max_concurrency
  image_dimension_cpu                                         = var.image_dimension_cpu
  redischeck_service_account                                  = var.redischeck_service_account
  redischeck_source_bucket                                    = var.redischeck_source_bucket
  redischeck_zip_file_name                                    = var.redischeck_zip_file_name
  redischeck_subscriber_cache_c_function_name                 = var.redischeck_subscriber_cache_c_function_name
  redischeck_subscriber_cache_c_topic                         = var.redischeck_subscriber_cache_c_topic
  redischeck_subscriber_cache_c_min_instance                  = var.redischeck_subscriber_cache_c_min_instance
  redischeck_subscriber_cache_c_max_instance                  = var.redischeck_subscriber_cache_c_max_instance
  redischeck_subscriber_cache_c_memory                        = var.redischeck_subscriber_cache_c_memory
  redischeck_subscriber_cache_c_timeout                       = var.redischeck_subscriber_cache_c_timeout
  redischeck_subscriber_cache_c_max_concurrency               = var.redischeck_subscriber_cache_c_max_concurrency
  redischeck_subscriber_cache_c_cpu                           = var.redischeck_subscriber_cache_c_cpu
  rmin_subscriber_cache_c_ip                                  = module.memstore.rmin_subscriber_cache_c_ip
  redischeck_mail_campaign_function_name                      = var.redischeck_mail_campaign_function_name
  redischeck_mail_campaign_topic                              = module.pub_sub.rmin_redischeck_mailCampaign_c_topic_id
  redischeck_mail_campaign_ext_topic                          = module.pub_sub.rmin_redischeck_mailCampaign_ext_c_topic_id
  redischeck_mail_campaign_min_instance                       = var.redischeck_mail_campaign_min_instance
  redischeck_mail_campaign_max_instance                       = var.redischeck_mail_campaign_max_instance
  redischeck_mail_campaign_memory                             = var.redischeck_mail_campaign_memory
  redischeck_mail_campaign_timeout                            = var.redischeck_mail_campaign_timeout
  redischeck_mail_campaign_max_concurrency                    = var.redischeck_mail_campaign_max_concurrency
  redischeck_mail_campaign_cpu                                = var.redischeck_mail_campaign_cpu
  rmin_mail_campaign_cache_c_ip                               = module.memstore.rmin_mail_campaign_cache_c_ip
  rmin_mail_campaign_cache_ext_c_ip                           = module.memstore.rmin_mail_campaign_cache_ext_c_ip
  redischeck_package_campaign_function_name                   = var.redischeck_package_campaign_function_name
  redischeck_package_campaign_topic                           = module.pub_sub.rmin_redischeck_packageCampaign_c_topic_id
  redischeck_package_campaign_ext_topic                       = module.pub_sub.rmin_redischeck_packageCampaign_ext_c_topic_id
  redischeck_package_campaign_min_instance                    = var.redischeck_package_campaign_min_instance
  redischeck_package_campaign_max_instance                    = var.redischeck_package_campaign_max_instance
  redischeck_package_campaign_memory                          = var.redischeck_package_campaign_memory
  redischeck_package_campaign_timeout                         = var.redischeck_package_campaign_timeout
  redischeck_package_campaign_max_concurrency                 = var.redischeck_package_campaign_max_concurrency
  redischeck_package_campaign_cpu                             = var.redischeck_package_campaign_cpu
  rmin_package_campaign_cache_c_ip                            = module.memstore.rmin_package_campaign_cache_c_ip
  rmin_package_campaign_cache_ext_c_ip                            = module.memstore.rmin_package_campaign_cache_ext_c_ip
  redischeck_mics_locks_c_function_name                       = var.redischeck_mics_locks_c_function_name
  redischeck_mics_locks_c_topic                               = var.redischeck_mics_locks_c_topic
  redischeck_mics_locks_c_min_instance                        = var.redischeck_mics_locks_c_min_instance
  redischeck_mics_locks_c_max_instance                        = var.redischeck_mics_locks_c_max_instance
  redischeck_mics_locks_c_memory                              = var.redischeck_mics_locks_c_memory
  redischeck_mics_locks_c_timeout                             = var.redischeck_mics_locks_c_timeout
  redischeck_mics_locks_c_max_concurrency                     = var.redischeck_mics_locks_c_max_concurrency
  redischeck_mics_locks_c_cpu                                 = var.redischeck_mics_locks_c_cpu
  rmin_mics_locks_cache_c_ip                                  = module.memstore.rmin_mics_locks_cache_c_ip
  name_suffix                                                 = var.name_suffix
  project_id                                                  = var.project_id
  rmin_alerts_e_avail_mem_mb                                  = var.rmin_alerts_e_avail_mem_mb
  rmin_alerts_e_domain_name                                   = var.rmin_alerts_e_domain_name
  rmin_alerts_e_from_email                                    = var.rmin_alerts_e_from_email
  rmin_alerts_e_max_instances                                 = var.rmin_alerts_e_max_instances
  rmin_alerts_e_resource                                      = module.pub_sub.rmin_alerts_topic_e_topic_id
  rmin_alerts_e_sa_email                                      = var.rmin_alerts_e_sa_email
  rmin_alerts_e_secret                                        = var.rmin_alerts_e_secret
  rmin_alerts_e_secret_version                                = var.rmin_alerts_e_secret_version
  rmin_alerts_e_timeout                                       = var.rmin_alerts_e_timeout
  rmin_alerts_e_to_email                                      = var.rmin_alerts_e_to_email
  rmin_alerts_e_vpc_connector                                 = var.rmin_alerts_e_vpc_connector
  rmin_cloud_zip5_timezone_func_c_bigquery_table              = var.rmin_cloud_zip5_timezone_func_c_bigquery_table
  rmin_cloud_zip5_timezone_func_c_available_cpu               = var.rmin_cloud_zip5_timezone_func_c_available_cpu
  rmin_cloud_zip5_timezone_func_c_max_concurrency             = var.rmin_cloud_zip5_timezone_func_c_max_concurrency
  rmin_cloud_zip5_timezone_func_c_max_instance                = var.rmin_cloud_zip5_timezone_func_c_max_instance
  rmin_cloud_zip5_timezone_func_c_memory                      = var.rmin_cloud_zip5_timezone_func_c_memory
  rmin_cloud_zip5_timezone_func_c_min_instance                = var.rmin_cloud_zip5_timezone_func_c_min_instance
  rmin_cloud_zip5_timezone_func_c_sa_email                    = var.rmin_cloud_zip5_timezone_func_c_sa_email
  rmin_cloud_zip5_timezone_func_c_timeout                     = var.rmin_cloud_zip5_timezone_func_c_timeout
  rmin_cloud_zip5_timezone_func_c_vpc_connector               = var.rmin_cloud_zip5_timezone_func_c_vpc_connector
  rmin_redischeck_flats_cache_c_avail_mem_mb                  = var.rmin_redischeck_flats_cache_c_avail_mem_mb
  rmin_redischeck_flats_cache_c_max_instances                 = var.rmin_redischeck_flats_cache_c_max_instances
  rmin_redischeck_flats_cache_c_redishost                     = module.memstore.rmin_flats_lock_cache_c_ip
  rmin_redischeck_flats_cache_c_resource                      = module.pub_sub.rmin_redischeck_flats_lock_c_id
  rmin_redischeck_flats_cache_c_sa_email                      = var.rmin_redischeck_flats_cache_c_sa_email
  rmin_redischeck_flats_cache_c_timeout                       = var.rmin_redischeck_flats_cache_c_timeout
  rmin_redischeck_flats_cache_c_vpc_connector                 = var.rmin_redischeck_flats_cache_c_vpc_connector
  rmin_redischeck_relay_cache_c_avail_mem_mb                  = var.rmin_redischeck_relay_cache_c_avail_mem_mb
  rmin_redischeck_relay_cache_c_max_instances                 = var.rmin_redischeck_relay_cache_c_max_instances
  rmin_redischeck_relay_cache_c_redishost                     = module.memstore.rmin_relay_locks_cache_c_ip
  rmin_redischeck_relay_cache_c_resource                      = module.pub_sub.rmin_redischeck_relay_lock_c_id
  rmin_redischeck_relay_cache_c_sa_email                      = var.rmin_redischeck_relay_cache_c_sa_email
  rmin_redischeck_relay_cache_c_timeout                       = var.rmin_redischeck_relay_cache_c_timeout
  rmin_redischeck_relay_cache_c_vpc_connector                 = var.rmin_redischeck_relay_cache_c_vpc_connector
  rmin_redischeck_mdnzip11s_cache_c_avail_mem_mb              = var.rmin_redischeck_mdnzip11s_cache_c_avail_mem_mb
  rmin_redischeck_mdnzip11s_cache_c_max_instances             = var.rmin_redischeck_mdnzip11s_cache_c_max_instances
  rmin_redischeck_mdnzip11s_cache_c_redishost                 = module.memstore.rmin_mdn_zip11s_cache_c_ip
  rmin_redischeck_mdnzip11s_cache_c_resource                  = module.pub_sub.rmin_redischeck_mdnzip11s_cache_c_topic_id
  rmin_redischeck_mdnzip11s_cache_c_sa_email                  = var.rmin_redischeck_mdnzip11s_cache_c_sa_email
  rmin_redischeck_mdnzip11s_cache_c_timeout                   = var.rmin_redischeck_mdnzip11s_cache_c_timeout
  rmin_redischeck_mdnzip11s_cache_c_vpc_connector             = var.rmin_redischeck_mdnzip11s_cache_c_vpc_connector
  rmin_redischeck_saturation_data_cache_e_avail_mem_mb        = var.rmin_redischeck_saturation_data_cache_e_avail_mem_mb
  rmin_redischeck_saturation_data_cache_e_max_instances       = var.rmin_redischeck_saturation_data_cache_e_max_instances
  rmin_redischeck_saturation_data_cache_e_redishost           = module.memstore.rmin_saturation_data_cache_e_ip
  rmin_redischeck_saturation_data_cache_e_resource            = module.pub_sub.rmin_redischeck_saturation_data_cache_e_topic_id
  rmin_redischeck_saturation_data_cache_e_sa_email            = var.rmin_redischeck_saturation_data_cache_e_sa_email
  rmin_redischeck_saturation_data_cache_e_timeout             = var.rmin_redischeck_saturation_data_cache_e_timeout
  rmin_redischeck_saturation_data_cache_e_vpc_connector       = var.rmin_redischeck_saturation_data_cache_e_vpc_connector
  rmin_redischeck_subscriber_email_cache_c_avail_mem_mb       = var.rmin_redischeck_subscriber_email_cache_c_avail_mem_mb
  rmin_redischeck_subscriber_email_cache_c_max_instances      = var.rmin_redischeck_subscriber_email_cache_c_max_instances
  rmin_redischeck_subscriber_email_cache_c_redishost          = module.memstore.rmin_subscriber_email_cache_c_ip
  rmin_redischeck_subscriber_email_cache_c_resource           = module.pub_sub.rmin_redischeck_subscriber_email_cache_c_topic_id
  rmin_redischeck_subscriber_email_cache_c_sa_email           = var.rmin_redischeck_subscriber_email_cache_c_sa_email
  rmin_redischeck_subscriber_email_cache_c_timeout            = var.rmin_redischeck_subscriber_email_cache_c_timeout
  rmin_redischeck_subscriber_email_cache_c_vpc_connector      = var.rmin_redischeck_subscriber_email_cache_c_vpc_connector
  rmin_redischeck_fs_subscriber_cache_redishost               = module.memstore.rmin_firestore_subscriber_cache_c_ip
  rmin_redischeck_fs_subscriber_cache_resource                = module.pub_sub.rmin_redischeck_fs_subscriber_cache_c_name
  rmin_redischeck_fs_subscriber_cache_memory                  = var.rmin_redischeck_fs_subscriber_cache_memory
  rmin_redischeck_fs_subscriber_email_cache_redishost         = module.memstore.rmin_firestore_subscriber_email_cache_c_ip
  rmin_redischeck_fs_subscriber_email_cache_resource          = module.pub_sub.rmin_redischeck_fs_subscriber_email_cache_c_name
  rmin_redischeck_fs_subscriber_email_cache_memory            = var.rmin_redischeck_fs_subscriber_email_cache_memory
  rmin_redischeck_zip5_initiatives_cache_redishost            = module.memstore.rmin_zip5_initiatives_sync_cache_c_ip
  rmin_redischeck_zip5_initiatives_cache_resource             = module.pub_sub.rmin_redischeck_zip5_initiatives_cache_c_name
  rmin_template_bucket                                        = module.cloud_storage.rmin_template_bucket_e_name
  vpc_connector                                               = module.connectors.vpc_connector_uri
  package_notification_connector                              = module.connectors.rmin_peripheral_conn_id
  subscriber_vpc_connector                                    = module.connectors.subscriber_connector_uri
  rmin_cloud_zip5_timezone_func_c_redis_ip                    = module.memstore.rmin_mdn_zip11s_cache_c_ip
  rmin_cloudsql_runpartman_c_db_host                          = var.rmin_cloudsql_runpartman_c_db_host
  rmin_cloudsql_runpartman_c_db_name                          = var.rmin_cloudsql_runpartman_c_db_name
  rmin_cloudsql_runpartman_c_db_port                          = var.rmin_cloudsql_runpartman_c_db_port
  rmin_cloudsql_runpartman_c_db_user                          = var.rmin_cloudsql_runpartman_c_db_user
  rmin_cloudsql_runpartman_c_available_cpu                    = var.rmin_cloudsql_runpartman_c_available_cpu
  rmin_cloudsql_runpartman_c_max_concurrency                  = var.rmin_cloudsql_runpartman_c_max_concurrency
  rmin_cloudsql_runpartman_c_max_instance                     = var.rmin_cloudsql_runpartman_c_max_instance
  rmin_cloudsql_runpartman_c_memory                           = var.rmin_cloudsql_runpartman_c_memory
  rmin_cloudsql_runpartman_c_min_instance                     = var.rmin_cloudsql_runpartman_c_min_instance
  rmin_cloudsql_runpartman_c_mount_path                       = var.rmin_cloudsql_runpartman_c_mount_path
  rmin_cloudsql_runpartman_c_sa_email                         = var.rmin_cloudsql_runpartman_c_sa_email
  rmin_cloudsql_runpartman_c_secret                           = module.cloudsql_mdn.rmin_mdn_db_user_secret_id
  rmin_cloudsql_runpartman_c_timeout                          = var.rmin_cloudsql_runpartman_c_timeout
  rmin_cloudsql_runpartman_c_vpc_connector                    = var.rmin_cloudsql_runpartman_c_vpc_connector
  rmin_cloudsql_runpartman_digest_db_host                     = var.rmin_cloudsql_runpartman_digest_db_host
  rmin_cloudsql_runpartman_digest_db_name                     = var.rmin_cloudsql_runpartman_digest_db_name
  rmin_cloudsql_runpartman_digest_db_port                     = var.rmin_cloudsql_runpartman_digest_db_port
  rmin_cloudsql_runpartman_digest_db_user                     = var.rmin_cloudsql_runpartman_digest_db_user
  rmin_cloudsql_runpartman_digest_available_cpu               = var.rmin_cloudsql_runpartman_digest_available_cpu
  rmin_cloudsql_runpartman_digest_max_concurrency             = var.rmin_cloudsql_runpartman_digest_max_concurrency
  rmin_cloudsql_runpartman_digest_max_instance                = var.rmin_cloudsql_runpartman_digest_max_instance
  rmin_cloudsql_runpartman_digest_memory                      = var.rmin_cloudsql_runpartman_digest_memory
  rmin_cloudsql_runpartman_digest_min_instance                = var.rmin_cloudsql_runpartman_digest_min_instance
  rmin_cloudsql_runpartman_digest_mount_path                  = var.rmin_cloudsql_runpartman_digest_mount_path
  rmin_cloudsql_runpartman_digest_sa_email                    = var.rmin_cloudsql_runpartman_digest_sa_email
  rmin_cloudsql_runpartman_digest_secret                      = module.cloudsql_digest.rmin_digest_db_user_secret_id
  rmin_cloudsql_runpartman_digest_timeout                     = var.rmin_cloudsql_runpartman_digest_timeout
  rmin_cloudsql_runpartman_digest_vpc_connector               = var.rmin_cloudsql_runpartman_digest_vpc_connector
  subscriber_update_function_cpu                              = var.subscriber_update_function_cpu
  subscriber_update_function_max_concurrency                  = var.subscriber_update_function_max_concurrency
  subscriber_update_function_max_instance                     = var.subscriber_update_function_max_instance
  subscriber_update_function_memory                           = var.subscriber_update_function_memory
  subscriber_update_function_min_instance                     = var.subscriber_update_function_min_instance
  subscriber_update_function_name                             = var.subscriber_update_function_name
  subscriber_update_function_service_account                  = var.subscriber_update_function_service_account
  subscriber_update_function_timeout                          = var.subscriber_update_function_timeout
  subscriber_update_function_zip_file_name                    = var.subscriber_update_function_zip_file_name
  subscribers_db_location                                     = module.subscriber_firestore.subscribers_location_id
  subscribers_db_name                                         = module.subscriber_firestore.subscribers_db_name
  firestore_subscribers_cache_ip                              = module.memstore.rmin_firestore_subscriber_cache_c_ip
  firestore_subscribers_cache_read_ip                         = module.memstore.rmin_firestore_subscriber_cache_c_read_ip
  firestore_subscribers_email_cache_ip                        = module.memstore.rmin_firestore_subscriber_email_cache_c_ip
  account_revision_topic                                      = module.pub_sub.rmin_account_revision_topic_name
  physical_address_revision_topic                             = module.pub_sub.rmin_physical_address_revision_topic_name
  package_notification_update_topic                           = module.pub_sub.rmin_package_notification_update_topic_name
  subscriber_opt_in_topic                                     = module.pub_sub.rmin_subscriber_opt_in_settings_topic_name
  rmin_mics_extract_avail_mem_mb                              = var.rmin_mics_extract_avail_mem_mb
  rmin_mics_extract_max_instances                             = var.rmin_mics_extract_max_instances
  rmin_mics_extract_sa_email                                  = var.rmin_mics_extract_sa_email
  rmin_mics_extract_table                                     = module.big_query.bigquery_dataset_id
  rmin_mics_extract_timeout                                   = var.rmin_mics_extract_timeout
  rmin_mics_extract_vpc_connector                             = module.connectors.subscriber_connector_uri
  rmin_mics_extract_cpu                                       = var.rmin_mics_extract_cpu
  rmin_mics_extract_max_concurrency                           = var.rmin_mics_extract_max_concurrency
  rmin_mics_extract_max_retry                                 = var.rmin_mics_extract_max_retry
  rmin_mics_subscriber_cloud_run_url                          = module.cloud_run.mics_subscriber_cloud_run_url
  rmin_mics_extract_queue_id                                  = var.rmin_mics_extract_queue_id
  rmin_mics_extract_location_id                               = var.rmin_mics_extract_location_id
  package_notification_topic                                  = module.pub_sub.rmin_package_notification_topic_name
  package_notification_trigger_function_cpu                   = var.package_notification_trigger_function_cpu
  package_notification_trigger_function_max_concurrency       = var.package_notification_trigger_function_max_concurrency
  package_notification_trigger_function_max_instance          = var.package_notification_trigger_function_max_instance
  package_notification_trigger_function_memory                = var.package_notification_trigger_function_memory
  package_notification_trigger_function_min_instance          = var.package_notification_trigger_function_min_instance
  package_notification_trigger_function_name                  = var.package_notification_trigger_function_name
  package_notification_trigger_function_service_account       = var.package_notification_trigger_function_service_account
  package_notification_trigger_function_timeout               = var.package_notification_trigger_function_timeout
  package_notification_trigger_function_zip_file_name         = var.package_notification_trigger_function_zip_file_name
  package_notification_trigger_mp_toggle                      = var.package_notification_trigger_mp_toggle
  package_vpc_connector                                       = module.connectors.package_connector_uri
  cloudsql_digest_secret_version                              = module.cloudsql_digest.rmin_digest_db_user_secret_latest_name
  cloudsql_mdn_secret_version                                 = module.cloudsql_mdn.rmin_mdn_db_user_secret_latest_name
  rmin_cloud_zip5_initiatives_sync_function_c_min_instance    = var.rmin_cloud_zip5_initiatives_sync_function_c_min_instance
  rmin_cloud_zip5_initiatives_sync_function_c_max_instance    = var.rmin_cloud_zip5_initiatives_sync_function_c_max_instance
  rmin_cloud_zip5_initiatives_sync_function_c_memory          = var.rmin_cloud_zip5_initiatives_sync_function_c_memory
  rmin_cloud_zip5_initiatives_sync_function_c_timeout         = var.rmin_cloud_zip5_initiatives_sync_function_c_timeout
  rmin_cloud_zip5_initiatives_sync_function_c_max_concurrency = var.rmin_cloud_zip5_initiatives_sync_function_c_max_concurrency
  rmin_cloud_zip5_initiatives_sync_function_c_available_cpu   = var.rmin_cloud_zip5_initiatives_sync_function_c_available_cpu
  rmin_cloud_zip5_initiatives_sync_function_c_redis_ip        = module.memstore.rmin_zip5_initiatives_sync_cache_c_ip
  rmin_cloud_zip5_initiatives_sync_function_c_bigquery_table  = module.big_query.rmin_cloud_zip5_initiatives_sync_function_c_bigquery_table
  rmin_cloud_zip5_initiatives_sync_function_c_sa_email        = var.rmin_cloud_zip5_initiatives_sync_function_c_sa_email
  rmin_cloud_zip5_initiatives_sync_function_c_vpc_connector   = module.connectors.rmin_peripheral_conn_id
  inbound_package_sync_topic                                  = module.pub_sub.rmin_inbound_package_sync_topic_name
  inbound_package_sync_trigger_function_cpu                   = var.inbound_package_sync_trigger_function_cpu
  inbound_package_sync_trigger_function_max_concurrency       = var.inbound_package_sync_trigger_function_max_concurrency
  inbound_package_sync_trigger_function_max_instance          = var.inbound_package_sync_trigger_function_max_instance
  inbound_package_sync_trigger_function_memory                = var.inbound_package_sync_trigger_function_memory
  inbound_package_sync_trigger_function_min_instance          = var.inbound_package_sync_trigger_function_min_instance
  inbound_package_sync_trigger_function_name                  = var.inbound_package_sync_trigger_function_name
  inbound_package_sync_trigger_function_service_account       = var.inbound_package_sync_trigger_function_service_account
  inbound_package_sync_trigger_function_timeout               = var.inbound_package_sync_trigger_function_timeout
  inbound_package_sync_trigger_function_zip_file_name         = var.inbound_package_sync_trigger_function_zip_file_name
  inbound_package_sync_connector                              = module.connectors.rmin_peripheral_conn_id
  inbound_package_sync_trigger_function_partitions            = var.inbound_package_sync_trigger_function_partitions
  process_failed_package_notif_function_c_available_cpu       = var.process_failed_package_notif_function_c_available_cpu
  process_failed_package_notif_function_c_max_concurrency     = var.process_failed_package_notif_function_c_max_concurrency
  process_failed_package_notif_function_c_max_instance        = var.process_failed_package_notif_function_c_max_instance
  process_failed_package_notif_function_c_memory              = var.process_failed_package_notif_function_c_memory
  process_failed_package_notif_function_c_min_instance        = var.process_failed_package_notif_function_c_min_instance
  process_failed_package_notif_function_c_sa_email            = var.process_failed_package_notif_function_c_sa_email
  process_failed_package_notif_function_c_timeout             = var.process_failed_package_notif_function_c_timeout
  package_email_notification_dlq_subscription_name            = module.pub_sub.rmin_package_email_notification_dlq_subscription_name
  package_email_notification_topic_name                       = module.pub_sub.rmin_package_notification_topic_name
  package_sms_notification_dlq_subscription_name              = module.pub_sub.rmin_package_sms_notification_dlq_subscription_name
  package_sms_notification_topic_name                         = module.pub_sub.rmin_package_sms_notification_topic_name
  mdn_eng_feed_function_max_instance                          = var.mdn_eng_feed_function_max_instance
  mdn_eng_feed_function_min_instance                          = var.mdn_eng_feed_function_min_instance
  mdn_eng_feed_function_memory                                = var.mdn_eng_feed_function_memory
  mdn_eng_feed_function_timeout                               = var.mdn_eng_feed_function_timeout
  mdn_eng_feed_function_max_concurrency                       = var.mdn_eng_feed_function_max_concurrency
  mdn_eng_feed_function_cpu                                   = var.mdn_eng_feed_function_cpu
  mdn_eng_feed_function_service_account                       = var.mdn_eng_feed_function_service_account
  mdn_eng_feed_function_connector                             = var.mdn_eng_feed_function_connector
  mdn_eng_feed_function_eng_toggle                            = var.mdn_eng_feed_function_eng_toggle
  mdn_eng_feed_function_azure_acct                            = var.mdn_eng_feed_function_azure_acct
  mdn_eng_feed_function_azure_cntr                            = var.mdn_eng_feed_function_azure_cntr
  mdn_eng_feed_function_azure_file                            = var.mdn_eng_feed_function_azure_file
  mdn_eng_feed_function_name                                  = var.mdn_eng_feed_function_name
  mdn_eng_feed_function_secret                                = var.mdn_eng_feed_function_secret
  mdn_eng_feed_function_mount_path                            = var.mdn_eng_feed_function_mount_path
  mdn_eng_feed_function_table_id                              = module.big_query.mdn_to_eng_processing_logs_bq_table_dataset_name
  mdn_eng_feed_function_file_bucket                           = module.cloud_storage.rmin_mdn_file_bucket_c_name
  mdn_eng_feed_function_temp_bucket                           = module.cloud_storage.rmin_mdn_temp_bucket_c_name
}

module "subnetwork" {
  source                                      = "./modules/subnetwork"
  project_id                                  = var.project_id
  authorized_network                          = module.vpc.rmin_e_vpc_id
  environment                                 = var.environment
  toggle_4583_1111_subscriber_services        = var.toggle_4583_1111_subscriber_services
  rmin_dashboard_serverless_vpc_name          = var.rmin_dashboard_serverless_vpc_name
  rmin_peripheral_vpc_name                    = var.rmin_peripheral_vpc_name
  rmin_email_serverless_vpc_name              = var.rmin_email_serverless_vpc_name
  rmin_peripheral_serverless_vpc_name         = var.rmin_peripheral_serverless_vpc_name
  rmin_dashboard_serverless_ip_cidr_range     = var.rmin_dashboard_serverless_ip_cidr_range
  rmin_peripheral_ip_cidr_range               = var.rmin_peripheral_ip_cidr_range
  rmin_email_serverless_ip_cidr_range         = var.rmin_email_serverless_ip_cidr_range
  rmin_peripheral_serverless_ip_cidr_range    = var.rmin_peripheral_serverless_ip_cidr_range
  idc_cloudrun_email_serverless_ip_cidr_range = var.idc_cloudrun_email_serverless_ip_cidr_range
  idc_cloudrun_email_serverless_name          = var.idc_cloudrun_email_serverless_name
  idc_cloudrun_email_serverless_network       = module.vpc.rmin_e_vpc_id
  rmin_e_dataflow_email_ip_cidr_range         = var.rmin_e_dataflow_email_ip_cidr_range
  rmin_e_dataflow_email_name                  = var.rmin_e_dataflow_email_name
  rmin_e_dataflow_email_network               = module.vpc.rmin_e_vpc_id
  rmin_e_dataflow_peripheral_ip_cidr_range    = var.rmin_e_dataflow_peripheral_ip_cidr_range
  rmin_e_dataflow_peripheral_name             = var.rmin_e_dataflow_peripheral_name
  rmin_e_dataflow_peripheral_network          = module.vpc.rmin_e_vpc_id
  rmin_e_serverless_connector_ip_cidr_range   = var.rmin_e_serverless_connector_ip_cidr_range
  rmin_e_serverless_connector_name            = var.rmin_e_serverless_connector_name
  rmin_e_serverless_connector_network         = module.vpc.rmin_e_vpc_id
  rmin_e_serverless_email_ip_cidr_range       = var.rmin_e_serverless_email_ip_cidr_range
  rmin_e_serverless_email_name                = var.rmin_e_serverless_email_name
  rmin_e_serverless_email_network             = module.vpc.rmin_e_vpc_id
  rmin_subscriber_serverless_vpc_name         = var.rmin_subscriber_serverless_vpc_name
  rmin_subscriber_serverless_ip_cidr_range    = var.rmin_subscriber_serverless_ip_cidr_range
  rmin_subscriber_peripheral_ip_cidr_range    = var.rmin_subscriber_peripheral_ip_cidr_range
  rmin_subscriber_peripheral_name             = var.rmin_subscriber_peripheral_name
  rmin_api_serverless_name                    = var.rmin_api_serverless_name
}

module "connectors" {
  source                                        = "./modules/connectors"
  project_id                                    = var.project_id
  toggle_4583_1111_subscriber_services          = var.toggle_4583_1111_subscriber_services
  toggle_4583_5673_myusps_migration             = var.toggle_4583_5673_myusps_migration
  dashboard_serverless_authorized_subnetwork    = module.subnetwork.rmin_dev_dashboard_serverless
  dashboard_serverless_connector_machine_type   = var.dashboard_serverless_connector_machine_type
  dashboard_serverless_connector_min_instances  = var.dashboard_serverless_connector_min_instances
  dashboard_serverless_connector_max_instances  = var.dashboard_serverless_connector_max_instances
  dashboard_serverless_conn_name                = var.dashboard_serverless_conn_name
  peripheral_serverless_authorized_subnetwork   = module.subnetwork.rmin_peripheral_serverless
  peripheral_serverless_connector_machine_type  = var.peripheral_serverless_connector_machine_type
  peripheral_serverless_connector_min_instances = var.peripheral_serverless_connector_min_instances
  peripheral_serverless_connector_max_instances = var.peripheral_serverless_connector_max_instances
  peripheral_serverless_conn_name               = var.peripheral_serverless_conn_name
  email_serverless_authorized_subnetwork        = module.subnetwork.rmin_email_serverless
  email_serverless_connector_machine_type       = var.email_serverless_connector_machine_type
  email_serverless_connector_min_instances      = var.email_serverless_connector_min_instances
  email_serverless_connector_max_instances      = var.email_serverless_connector_max_instances
  email_serverless_conn_name                    = var.email_serverless_conn_name
  rmin_serverless_conn_name                     = var.rmin_serverless_conn_name
  rmin_serverless_conn_subnet_name              = module.subnetwork.rmin_e_serverless_connector_name
  idc_email_serverless_name                     = var.idc_email_serverless_name
  idc_email_serverless_subnet_name              = module.subnetwork.idc_cloudrun_email_serverless_name
  rmin_e_servless_email_name                    = var.rmin_e_servless_email_name
  rmin_e_servless_email_subnet_name             = module.subnetwork.rmin_e_serverless_email_name
  subscriber_serverless_authorized_subnetwork   = module.subnetwork.rmin_subscriber_serverless
  subscriber_serverless_conn_name               = var.subscriber_serverless_conn_name
  subscriber_serverless_connector_machine_type  = var.subscriber_serverless_connector_machine_type
  subscriber_serverless_connector_max_instances = var.subscriber_serverless_connector_max_instances
  subscriber_serverless_connector_min_instances = var.subscriber_serverless_connector_min_instances
  rmin_api_conn_name                            = var.rmin_api_conn_name
  rmin_api_conn_subnet_name                     = module.subnetwork.rmin_api_serverless_name
  package_serverless_conn_name                  = var.package_serverless_conn_name
  package_serverless_connector_machine_type     = var.package_serverless_connector_machine_type
  package_serverless_connector_max_instances    = var.package_serverless_connector_max_instances
  package_serverless_connector_min_instances    = var.package_serverless_connector_min_instances
  environment                                   = var.environment
  spring_profile                                = var.spring_profile
}

module "memstore" {
  source                                         = "./modules/memstore"
  project_id                                     = var.project_id
  authorized_network                             = module.vpc.rmin_e_vpc_id
  name_suffix                                    = var.name_suffix
  toggle_4583_1111_subscriber_services           = var.toggle_4583_1111_subscriber_services
  toggle_4583_5681_consumer_portal               = var.toggle_4583_5681_consumer_portal
  toggle_4583_xxxx_ext_caches                    = var.toggle_4583_xxxx_ext_caches
  redis_reserved_ip_range_central                = module.vpc.rmin_psc_ip_redis_central_name
  redis_reserved_ip_range_east                   = module.vpc.rmin_e_pvt_svc_connection_name
  rmin_flats_lock_cache_c_memory_size_gb         = var.rmin_flats_lock_cache_c_memory_size_gb
  rmin_flats_lock_cache_c_replica_enabled        = var.rmin_flats_lock_cache_c_replica_enabled
  rmin_flats_lock_cache_c_replica_count          = var.rmin_flats_lock_cache_c_replica_count
  rmin_mail_campaign_cache_c_memory_size_gb      = var.rmin_mail_campaign_cache_c_memory_size_gb
  rmin_mail_campaign_cache_c_replica_count       = var.rmin_mail_campaign_cache_c_replica_count
  rmin_mail_campaign_cache_c_replica_enabled     = var.rmin_mail_campaign_cache_c_replica_enabled
  rmin_mail_campaign_cache_ext_c_memory_size_gb  = var.rmin_mail_campaign_cache_ext_c_memory_size_gb
  rmin_mail_campaign_cache_ext_c_replica_count   = var.rmin_mail_campaign_cache_ext_c_replica_count
  rmin_mail_campaign_cache_ext_c_replica_enabled = var.rmin_mail_campaign_cache_ext_c_replica_enabled
  rmin_mdn_zip11s_cache_c_memory_size_gb         = var.rmin_mdn_zip11s_cache_c_memory_size_gb
  rmin_mdn_zip11s_cache_c_replica_count          = var.rmin_mdn_zip11s_cache_c_replica_count
  rmin_mdn_zip11s_cache_c_replica_enabled        = var.rmin_mdn_zip11s_cache_c_replica_enabled
  rmin_mics_locks_cache_c_memory_size_gb         = var.rmin_mics_locks_cache_c_memory_size_gb
  rmin_mics_locks_cache_c_replica_count          = var.rmin_mics_locks_cache_c_replica_count
  rmin_mics_locks_cache_c_replica_enabled        = var.rmin_mics_locks_cache_c_replica_enabled
  rmin_package_campaign_cache_c_memory_size_gb   = var.rmin_package_campaign_cache_c_memory_size_gb
  rmin_package_campaign_cache_c_replica_count    = var.rmin_package_campaign_cache_c_replica_count
  rmin_package_campaign_cache_c_replica_enabled  = var.rmin_package_campaign_cache_c_replica_enabled
  rmin_package_campaign_cache_ext_c_memory_size_gb   = var.rmin_package_campaign_cache_ext_c_memory_size_gb
  rmin_package_campaign_cache_ext_c_replica_count    = var.rmin_package_campaign_cache_ext_c_replica_count
  rmin_package_campaign_cache_ext_c_replica_enabled  = var.rmin_package_campaign_cache_ext_c_replica_enabled
  rmin_relay_locks_cache_c_memory_size_gb        = var.rmin_relay_locks_cache_c_memory_size_gb
  rmin_relay_locks_cache_c_replica_enabled       = var.rmin_relay_locks_cache_c_replica_enabled
  rmin_saturation_data_cache_e_memory_size_gb    = var.rmin_saturation_data_cache_e_memory_size_gb
  rmin_saturation_data_cache_e_replica_count     = var.rmin_saturation_data_cache_e_replica_count
  rmin_saturation_data_cache_e_replica_enabled   = var.rmin_saturation_data_cache_e_replica_enabled
  rmin_subscriber_cache_c_memory_size_gb         = var.rmin_subscriber_cache_c_memory_size_gb
  rmin_subscriber_cache_c_replica_count          = var.rmin_subscriber_cache_c_replica_count
  rmin_subscriber_cache_c_replica_enabled        = var.rmin_subscriber_cache_c_replica_enabled
  rmin_subscriber_email_cache_c_memory_size_gb   = var.rmin_subscriber_email_cache_c_memory_size_gb
  rmin_subscriber_email_cache_c_replica_count    = var.rmin_subscriber_email_cache_c_replica_count
  rmin_subscriber_email_cache_c_replica_enabled  = var.rmin_subscriber_email_cache_c_replica_enabled
  rmin_fs_subscriber_cache_memory_size_gb        = var.rmin_fs_subscriber_cache_memory_size_gb
  rmin_fs_subscriber_cache_replica_count         = var.rmin_fs_subscriber_cache_replica_count
  rmin_fs_subscriber_cache_replica_enabled       = var.rmin_fs_subscriber_cache_replica_enabled
  rmin_fs_subscriber_email_cache_memory_size_gb  = var.rmin_fs_subscriber_email_cache_memory_size_gb
  rmin_fs_subscriber_email_cache_replica_count   = var.rmin_fs_subscriber_email_cache_replica_count
  rmin_fs_subscriber_email_cache_replica_enabled = var.rmin_fs_subscriber_email_cache_replica_enabled
  rmin_zip5_initiatives_cache_c_memory_size_gb   = var.rmin_zip5_initiatives_cache_c_memory_size_gb
  rmin_zip5_initiatives_cache_c_replica_enabled  = var.rmin_zip5_initiatives_cache_c_replica_enabled
  rmin_zip5_initiatives_cache_c_replica_count    = var.rmin_zip5_initiatives_cache_c_replica_count
}

module "cloud_scheduler" {
  source                                                = "./modules/cloud_scheduler"
  project_id                                            = var.project_id
  name_suffix                                           = var.name_suffix
  toggle_4583_1111_subscriber_services                  = var.toggle_4583_1111_subscriber_services
  toggle_4583_5681_consumer_portal                      = var.toggle_4583_5681_consumer_portal
  toggle_4583_5680_frontend                             = var.toggle_4583_5680_frontend
  toggle_4583_5708_mdn_to_eng                           = var.toggle_4583_5708_mdn_to_eng
  toggle_4583_5710_apigee_hybrid                        = var.toggle_4583_5710_apigee_hybrid
  toggle_4583_5717_rmin_backup_invar                    = var.toggle_4583_5717_rmin_backup
  
  // rmin_redis_cache_backup_scheduler_e
  rmin_redis_export_backup_scheduler_region_invar       = var.rmin_redis_export_backup_scheduler_region
  rmin_redis_export_backup_scheduler_schedule_invar     = var.rmin_redis_export_backup_scheduler_schedule         
  rmin_redis_export_backup_scheduler_timezone_invar     = var.rmin_redis_export_backup_scheduler_timezone           
  rmin_redis_export_backup_service_account_invar        = var.rmin_redis_export_backup_service_account
  rmin_redis_export_backup_bucket_name_invar            = module.cloud_storage.rmin_redis_export_backup_bucket_name_outvar

  // rmin_operationaldata_bigquery_export_e
  rmin_bigquery_export_backup_scheduler_region_invar    = var.rmin_bigquery_export_backup_scheduler_region
  rmin_bigquery_export_backup_scheduler_schedule_invar  = var.rmin_bigquery_export_backup_scheduler_schedule        
  rmin_bigquery_export_backup_scheduler_timezone_invar  = var.rmin_bigquery_export_backup_scheduler_timezone
  rmin_bigquery_export_backup_service_account_invar     = var.rmin_bigquery_export_backup_service_account
  rmin_bigquery_export_backup_bucket_name_invar         = module.cloud_storage.rmin_bigquery_export_backup_bucket_name_outvar
  
  timezone_list                                         = local.timezone_list
  rmin_template_bucket                                  = module.cloud_storage.rmin_template_bucket_e_name
  rmin_gcr_pruner_attempt_deadline                      = var.rmin_gcr_pruner_attempt_deadline
  rmin_gcr_pruner_cloud_run_url                         = var.rmin_gcr_pruner_cloud_run_url
  rmin_gcr_pruner_paused                                = var.rmin_gcr_pruner_paused
  rmin_gcr_pruner_sa_email                              = var.rmin_gcr_pruner_sa_email
  rmin_gcr_pruner_schedule                              = var.rmin_gcr_pruner_schedule
  rmin_report_email_completion_tz_cloud_run_url         = var.rmin_report_email_completion_tz_cloud_run_url
  rmin_report_email_completion_tz_sa_email              = var.rmin_report_email_completion_tz_sa_email
  rmin_report_email_completion_tz_schedule              = var.rmin_report_email_completion_tz_schedule
  rmin_report_email_sla_timezone_sunday_cloud_run_url   = var.rmin_report_email_sla_timezone_sunday_cloud_run_url
  rmin_report_email_sla_timezone_sunday_sa_email        = var.rmin_report_email_sla_timezone_sunday_sa_email
  rmin_report_email_sla_timezone_sunday_schedule        = var.rmin_report_email_sla_timezone_sunday_schedule
  rmin_report_file_and_email_sla_timezone_cloud_run_url = var.rmin_report_file_and_email_sla_timezone_cloud_run_url
  rmin_report_file_and_email_sla_timezone_sa_email      = var.rmin_report_file_and_email_sla_timezone_sa_email
  rmin_report_file_and_email_sla_timezone_schedule      = var.rmin_report_file_and_email_sla_timezone_schedule
  rmin_report_missing_emails_cloud_run_url              = var.rmin_report_missing_emails_cloud_run_url
  rmin_report_missing_emails_sa_email                   = var.rmin_report_missing_emails_sa_email
  rmin_report_missing_emails_schedule                   = var.rmin_report_missing_emails_schedule
  rmin_report_processing_volumes_cloud_run_url          = var.rmin_report_processing_volumes_cloud_run_url
  rmin_report_processing_volumes_sa_email               = var.rmin_report_processing_volumes_sa_email
  rmin_report_processing_volumes_schedule               = var.rmin_report_processing_volumes_schedule
  rmin_report_zip5_email_processing_time_cloud_run_url  = var.rmin_report_zip5_email_processing_time_cloud_run_url
  rmin_report_zip5_email_processing_time_sa_email       = var.rmin_report_zip5_email_processing_time_sa_email
  rmin_report_zip5_email_processing_time_schedule       = var.rmin_report_zip5_email_processing_time_schedule
  run_partman_c_attempt_deadline                        = var.run_partman_c_attempt_deadline
  run_partman_c_func_url                                = var.run_partman_c_func_url
  run_partman_c_sa_email                                = var.run_partman_c_sa_email
  run_partman_c_schedule                                = var.run_partman_c_schedule
  run_partman_digest_attempt_deadline                   = var.run_partman_digest_attempt_deadline
  run_partman_digest_func_url                           = var.run_partman_digest_func_url
  run_partman_digest_sa_email                           = var.run_partman_digest_sa_email
  run_partman_digest_schedule                           = var.run_partman_digest_schedule
  run_zip5_timezone_c_attempt_deadline                  = var.run_zip5_timezone_c_attempt_deadline
  run_zip5_timezone_c_func_url                          = var.run_zip5_timezone_c_func_url
  run_zip5_timezone_c_sa_email                          = var.run_zip5_timezone_c_sa_email
  run_zip5_timezone_c_schedule                          = var.run_zip5_timezone_c_schedule
  sunday_digest_cloud_run_version_central               = var.sunday_digest_cloud_run_version_central
  sunday_digest_error_topic                             = var.sunday_digest_error_topic
  sunday_digest_max_workers                             = var.sunday_digest_max_workers
  sunday_digest_redis_max_conn                          = var.sunday_digest_redis_max_conn
  sunday_digest_redis_max_idle                          = var.sunday_digest_redis_max_idle
  sunday_digest_redis_min_idle                          = var.sunday_digest_redis_min_idle
  sunday_digest_redishost                               = var.rmin_subscriber_cache_c_replica_enabled ? module.memstore.rmin_subscriber_cache_c_read_ip : module.memstore.rmin_subscriber_cache_c_read_ip
  sunday_digest_database                                = var.sunday_digest_database
  sunday_digest_sa_email                                = var.sunday_digest_sa_email
  sunday_digest_logging_table                           = var.sunday_digest_logging_table
  sunday_digest_schedule                                = var.sunday_digest_schedule
  sunday_digest_sdk_log_level                           = var.sunday_digest_sdk_log_level
  sunday_digest_sub_drop_bucket                         = var.sunday_digest_sub_drop_bucket
  sunday_digest_subnetwork                              = var.sunday_digest_subnetwork
  sunday_digest_subnetwork_central                      = trimprefix(module.subnetwork.rmin_peripheral_id, "projects/${var.project_id}/")
  sunday_digest_toggle_dedupe_sunday_email              = var.sunday_digest_toggle_dedupe_sunday_email
  sunday_digest_toggle_email_cache_lookup               = var.sunday_digest_toggle_email_cache_lookup
  sunday_digest_topic_name_central                      = module.pub_sub.rmin_zip5_done_topic_c_name
  rmin_mics_extract_trigger_func_url                    = module.cloud_function.rmin_cloud_mics_extract_function_url
  rmin_mics_extract_trigger_sa_email                    = var.rmin_mics_extract_sa_email
  rmin_mics_extract_trigger_schedule                    = var.rmin_mics_extract_trigger_schedule
  cache_refresh_max_workers                             = var.cache_refresh_max_workers
  cache_refresh_redis_max_conn                          = var.cache_refresh_redis_max_conn
  cache_refresh_redis_max_idle                          = var.cache_refresh_redis_max_idle
  cache_refresh_redis_min_idle                          = var.cache_refresh_redis_min_idle
  cache_refresh_redis_max_wait_millis                   = var.cache_refresh_redis_max_wait_millis
  cache_refresh_redis_timeout_millis                    = var.cache_refresh_redis_timeout_millis
  cache_refresh_sa_email                                = var.cache_refresh_sa_email
  cache_refresh_schedule                                = var.cache_refresh_schedule
  cache_refresh_subnetwork                              = var.cache_refresh_subnetwork
  cache_refresh_version                                 = var.cache_refresh_version
  cache_refresh_partition_count                         = var.cache_refresh_partition_count
  subscriber_cache_redishost                            = module.memstore.rmin_firestore_subscriber_cache_c_ip
  subscriber_email_cache_redishost                      = module.memstore.rmin_firestore_subscriber_email_cache_c_ip
  rmin_zip5_initiatives_sync_sa_email                   = var.rmin_zip5_initiatives_sync_sa_email
  rmin_zip5_initiatives_sync_cloud_run_url              = module.cloud_function.rmin_cloud_zip5_initiatives_sync_function_c_url
  cloud_run_warming_sa                                  = var.cloud_run_warming_sa
  dashboard_api_internal_pre_warm_min_instances         = var.dashboard_api_internal_pre_warm_min_instances
  dashboard_api_internal_pre_warm_schedule              = var.dashboard_api_internal_pre_warm_schedule
  dashboard_api_internal_post_warm_schedule             = var.dashboard_api_internal_post_warm_schedule
  dashboard_api_internal_service_name                   = module.cloud_run.dashboard_api_internal_service_name
  dashboard_api_internal_post_warm_min_instances        = var.dashboard_api_internal_min_instance_count
  frontend_apis_post_warm_schedule                      = var.frontend_apis_post_warm_schedule
  image_api_pre_warm_min_instances                      = var.image_api_pre_warm_min_instances
  consumer_portal_pre_warm_min_instances                = var.consumer_portal_pre_warm_min_instances
  consumer_portal_post_warm_min_instances               = var.consumer_portal_min_instance_count
  consumer_portal_service_name                          = module.cloud_run.consumer_portal_service_name
  dashboard_api_pre_warm_min_instances                  = var.dashboard_api_pre_warm_min_instances
  dashboard_api_post_warm_min_instances                 = var.dashboard_api_min_instance_count
  dashboard_api_service_name                            = module.cloud_run.dashboard_api_service_name
  eagan_proxy_pre_warm_min_instances                    = var.eagan_proxy_pre_warm_min_instances
  eagan_proxy_post_warm_min_instances                   = var.eagan_proxy_min_instance_count
  eagan_proxy_service_name                              = module.cloud_run.eagan_proxy_service_name
  frontend_apis_pre_warm_schedule                       = var.frontend_apis_pre_warm_schedule
  image_api_post_warm_min_instances                     = var.image_api_min_instance_count
  image_api_service_name                                = module.cloud_run.image_api_service_name
  login_api_pre_warm_min_instances                      = var.login_api_pre_warm_min_instances
  login_api_post_warm_min_instances                     = var.login_api_min_instance_count
  login_api_service_name                                = module.cloud_run.login_api_service_name
  package_api_pre_warm_min_instances                    = var.package_api_pre_warm_min_instances
  package_api_post_warm_min_instances                   = var.package_api_min_instance_count
  package_api_service_name                              = module.cloud_run.package_api_service_name
  subscriber_api_pre_warm_min_instances                 = var.subscriber_api_pre_warm_min_instances
  subscriber_api_post_warm_min_instances                = var.subscriber_api_min_instance_count
  subscriber_api_service_name                           = module.cloud_run.subscriber_api_service_name
  mdn_eng_feed_version                                  = var.mdn_eng_feed_version
  mdn_eng_feed_sa_email                                 = var.mdn_eng_feed_sa_email
  mdn_eng_feed_schedule                                 = var.mdn_eng_feed_schedule
  mdn_eng_feed_database                                 = module.big_query.mdn_to_eng_processing_logs_bq_table_dataset_id
  mdn_eng_feed_temp_bucket                              = module.cloud_storage.rmin_mdn_temp_bucket_c_name
  mdn_eng_feed_num_shard                                = var.mdn_eng_feed_num_shard
  mdn_eng_feed_table                                    = module.big_query.mdn_to_eng_processing_logs_bq_table_name
  mdn_eng_feed_firestore_subscribers                    = module.subscriber_firestore.subscribers_db_name
  mdn_eng_feed_workers                                  = var.mdn_eng_feed_workers
  mdn_eng_feed_subnetwork                               = var.mdn_eng_feed_subnetwork
  process_failed_package_notifications_url              = module.cloud_function.rmin_cloud_process_failed_package_notifications_c_url
  process_failed_package_notifications_sa_email         = var.process_failed_package_notif_function_c_sa_email
}

module "vpc" {
  source                         = "./modules/vpc"
  rmin_e_vpc_name                = var.rmin_e_vpc_name
  project_id                     = var.project_id
  rmin_e_pvt_svc_connection_name = var.rmin_e_pvt_svc_connection_name
}

module "cloud_nat" {
  source                                   = "./modules/cloud_nat"
  cloud_nat_name                           = var.cloud_nat_name
  cloud_nat_subnetwork_cloudrun_email_name = module.subnetwork.idc_cloudrun_email_serverless_name
  cloud_nat_subnetwork_dataflow_email_name = module.subnetwork.rmin_e_dataflow_email_name
  cloud_nat_subnetwork_email_name          = module.subnetwork.rmin_e_serverless_email_name
  external_nat_ip_name                     = var.external_nat_ip_name
  router_name                              = var.router_name
  router_network                           = module.vpc.rmin_e_vpc_id

}


module "cloudsql_digest" {
  source                                     = "./modules/cloudsql_digest"
  digest_db_instance_allocated_ip_range      = var.digest_db_instance_allocated_ip_range
  digest_db_instance_availability_type       = var.digest_db_instance_availability_type
  digest_db_instance_disk_autoresize         = var.digest_db_instance_disk_autoresize
  digest_db_instance_disk_autoresize_limit   = var.digest_db_instance_disk_autoresize_limit
  digest_db_instance_disk_size_gb            = var.digest_db_instance_disk_size_gb
  digest_db_instance_private_network         = module.vpc.rmin_e_vpc_id
  digest_db_instance_query_insights_enabled  = var.digest_db_instance_query_insights_enabled
  digest_db_instance_query_string_length     = var.digest_db_instance_query_string_length
  digest_db_instance_record_application_tags = var.digest_db_instance_record_application_tags
  digest_db_instance_record_client_address   = var.digest_db_instance_record_client_address
  digest_db_instance_retained_backups_count  = var.digest_db_instance_retained_backups_count
  digest_db_instance_log_rentention_days     = var.digest_db_instance_log_rentention_days
  environment                                = var.environment
  project_id                                 = var.project_id
  rmin_digest_db_user_name                   = var.rmin_digest_db_user_name
  digest_db_instance_tier                    = var.digest_db_instance_tier
  digest_db_instance_maint_update_track      = var.digest_db_instance_maint_update_track
}

module "cloudsql_mdn" {
  source                                  = "./modules/cloudsql_mdn"
  mdn_db_instance_allocated_ip_range      = var.mdn_db_instance_allocated_ip_range
  mdn_db_instance_availability_type       = var.mdn_db_instance_availability_type
  mdn_db_instance_disk_autoresize         = var.mdn_db_instance_disk_autoresize
  mdn_db_instance_disk_autoresize_limit   = var.mdn_db_instance_disk_autoresize_limit
  mdn_db_instance_disk_size_gb            = var.mdn_db_instance_disk_size_gb
  mdn_db_instance_private_network         = module.vpc.rmin_e_vpc_id
  mdn_db_instance_query_insights_enabled  = var.mdn_db_instance_query_insights_enabled
  mdn_db_instance_query_string_length     = var.mdn_db_instance_query_string_length
  mdn_db_instance_record_application_tags = var.mdn_db_instance_record_application_tags
  mdn_db_instance_record_client_address   = var.mdn_db_instance_record_client_address
  mdn_db_instance_retained_backups_count  = var.mdn_db_instance_retained_backups_count
  mdn_db_instance_log_rentention_days     = var.mdn_db_instance_log_rentention_days
  environment                             = var.environment
  project_id                              = var.project_id
  rmin_mdn_db_user_name                   = var.rmin_mdn_db_user_name
  mdn_db_instance_tier                    = var.mdn_db_instance_tier
  mdn_db_instance_maint_update_track      = var.mdn_db_instance_maint_update_track
}

module "certs" {
  source               = "./modules/certs"
  project_id           = var.project_id
  environment          = var.environment
  private_key_filename = var.private_key_filename
  certificate_filename = var.certificate_filename
}


module "internal_lb" {
  source                   = "./modules/internal_lb"
  project_id               = var.project_id
  environment              = var.environment
  id_env_url               = var.id_env_url
  informeddelivery_env_url = var.informeddelivery_env_url
  private_key_filename     = var.private_key_filename
  certificate_filename     = var.certificate_filename
  int_lb_subnetwork        = var.int_lb_subnetwork
  rmin_lb_ip_int_c_address = var.rmin_lb_ip_int_c_address
  rmin_id_cert_c_id        = module.certs.rmin_id_cert_c_id
}

module "external_lb" {
  count                    = var.spring_profile == "00p" || var.spring_profile == "00c" || var.spring_profile == "01c" ? 1 : 0
  source                   = "./modules/external_lb"
  project_id               = var.project_id
  environment              = var.environment
  id_env_url               = var.id_env_url
  informeddelivery_env_url = var.informeddelivery_env_url
  private_key_filename     = var.private_key_filename
  certificate_filename     = var.certificate_filename
  rmin_ext_lb_fe_c_network = module.vpc.rmin_e_vpc_id
  rmin_lb_ip_ext_c_address = var.rmin_lb_ip_ext_c_address
  rmin_id_cert_c_id        = module.certs.rmin_id_cert_c_id
}

module "cloudsql_mc" {
  source                                  = "./modules/cloudsql_mc"
  mc_db_instance_allocated_ip_range      = var.mc_db_instance_allocated_ip_range
  mc_db_instance_availability_type       = var.mc_db_instance_availability_type
  mc_db_instance_disk_autoresize         = var.mc_db_instance_disk_autoresize
  mc_db_instance_disk_autoresize_limit   = var.mc_db_instance_disk_autoresize_limit
  mc_db_instance_disk_size_gb            = var.mc_db_instance_disk_size_gb
  mc_db_instance_private_network         = module.vpc.rmin_e_vpc_id
  mc_db_instance_query_insights_enabled  = var.mc_db_instance_query_insights_enabled
  mc_db_instance_query_string_length     = var.mc_db_instance_query_string_length
  mc_db_instance_record_application_tags = var.mc_db_instance_record_application_tags
  mc_db_instance_record_client_address   = var.mc_db_instance_record_client_address
  mc_db_instance_retained_backups_count  = var.mc_db_instance_retained_backups_count
  mc_db_instance_log_rentention_days     = var.mc_db_instance_log_rentention_days
  environment                            = var.environment
  project_id                             = var.project_id
  rmin_mc_db_user_name                   = var.rmin_mc_db_user_name
  mc_db_instance_tier                    = var.mc_db_instance_tier
  mc_db_instance_maint_update_track      = var.mc_db_instance_maint_update_track
}

